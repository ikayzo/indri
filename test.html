<!DOCTYPE html>
<html>

<head>
	<script type="text/javascript" src="js/3rdparty/jquery-1.10.2.js"></script>
	<!-- Foundation -->
	<script type="text/javascript" src="js/3rdparty/foundation.min.js"></script>
	<link rel="stylesheet" type="text/css" href="css/foundation.min.css">

	<!-- Bootstrap CDN -->
	<!--<script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
	<link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">-->

	<link rel="stylesheet" type="text/css" href="css/indri.css">
	<link rel="stylesheet" type="text/css" href="css/base.css">
	<link rel="stylesheet" type="text/css" href="css/styles.css">
</head>

<body>
	<h2>Indri test page</h2>
	<div>
		File system:
		<select id="fileSystem">
			<option value="local">Local file system</option>
			<option value="ikayzo">Ikayzo S3</option>
			<option value="civilbeat">Civil Beat S3</option>
		</select>
	</div>

	<div>
		<button id="openBtn">Open...</button>
		<button id="saveBtn">Save...</button>
		<button id="debugBtn">Debug...</button>
	</div>

	<div id="myModal" class="reveal-modal">
	  <h2>Awesome. I have it.</h2>
	  <p class="lead">Your couch.  It is mine.</p>
	  <p>Im a cool paragraph that lives inside of an even cooler modal. Wins</p>
	  <a class="close-reveal-modal">&#215;</a>
	</div>
 
	Results:
	<div id="results"/>

	<hr>

<script type="text/javascript" src="js/indri.fsm.js"></script>
<script type="text/javascript" src="js/indri.base.js"></script>
<script type="text/javascript" src="js/indri.content.renderer.base.js"></script>
<script type="text/javascript" src="js/indri.content.renderers.js"></script>
<script type="text/javascript" src="js/indri.location.renderers.js"></script>
<script type="text/javascript" src="js/indri.main.js"></script>

<script type="text/javascript">

	function showDialog(defaults) {
		var initializer = jQuery.extend(true, {}, defaults);
		initStandardExtensions(initializer);

		var fsLookup = {
			local : initLocalFileSystem,
			ikayzo : initAwsFileSystem,
			civilbeat : initCivilBeatFileSystem,
		};

		var fs = jQuery('#fileSystem').find('option:selected').val();
		fsLookup[fs](initializer);

		initializer.resultCallback = function(results) { 
			$('#myModal').foundation('reveal', 'close'); 
			console.log(results); 
		};

		console.log(initializer);
		//var returnVal = window.showModalDialog('indri.html', initializer);

		jQuery('#myModal').load('indri.html #browserui', function() {
			new FileBrowser(jQuery("#browserui"), new FileSystemManager("http://localhost:1337/"), initializer);
			$('#myModal').foundation('reveal', 'open'); 
		});
		
		//$('#myModal').foundation('reveal', 'open', "http://localhost/indri/indri.html");
		/*
		$('#myModal').foundation('reveal', 'open', {
			url: 'indri.html',
			success: function(data) {
				console.log(data);
			},
			error: function() {
				console.log('Error opening modal');
			},
		});
*/
	}


	function initStandardExtensions(initializer) {
		initializer.filter.options.push({ value: "\.(htm|html)$", text: "HTML files (*.htm, *.html)"});
		initializer.filter.options.push({ value: "\.js$", text: "Javascript files (*.js)"});
		initializer.filter.options.push({ value: "\.(jpg|png)", text: "Image files (*.jpg, *.png)"});
	}

	function initLocalFileSystem(initializer) {
		initializer.locationRenderer = new SegmentedLocationRenderer();
	}

	function initAwsFileSystem(initializer) {
		initializer.visibility.shortcutsPanel = true;

		initializer.locationRenderer = new BucketLocationRenderer();

		initializer.previewRenderer.baseUrl = 'http://ikayzo-files.s3.amazonaws.com/';
	}

	function initCivilBeatFileSystem(initializer) {
		initializer.visibility.shortcutsPanel = true;

		initializer.locationRenderer = new BucketLocationRenderer();

		initializer.previewRenderer.baseUrl = 'http://civilbeat_production.s3.amazonaws.com/';
	}


	jQuery(document).ready(function() {
		jQuery(document).foundation();

		jQuery("#openBtn").click(function() { showDialog(FileBrowser.prototype.OpenDialogInitializer); });
		jQuery("#saveBtn").click(function() { showDialog(FileBrowser.prototype.SaveDialogInitializer); });
		jQuery("#debugBtn").click(function() { showDialog(FileBrowser.prototype.DebugDialogInitializer); });
	});
</script>

</body>
</html>