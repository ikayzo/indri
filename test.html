<!DOCTYPE html>
<html>

<head>
	<script type="text/javascript" src="js/3rdparty/jquery-1.10.2.js"></script>
</head>

<body>
	<h2>Indri test page</h2>
	<div>
		File system:
		<select id="fileSystem">
			<option value="local">Local file system</option>
			<option value="ikayzo">Ikayzo S3</option>
			<option value="civilbeat">Civil Beat S3</option>
		</select>
	</div>

	<div>
		<button id="openBtn">Open...</button>
		<button id="saveBtn">Save...</button>
		<button id="debugBtn">Debug...</button>
	</div>

	Results:
	<div id="results"/>

	<hr>

<script type="text/javascript" src="js/indri.fsm.js"></script>
<script type="text/javascript" src="js/indri.base.js"></script>
<script type="text/javascript" src="js/indri.content.renderer.base.js"></script>
<script type="text/javascript" src="js/indri.content.renderers.js"></script>
<script type="text/javascript" src="js/indri.location.renderers.js"></script>
<script type="text/javascript" src="js/indri.main.js"></script>

<script type="text/javascript">

	function showDialog(defaults) {
		var initializer = jQuery.extend(true, {}, defaults);
		initStandardExtensions(initializer);

		var fsLookup = {
			local : initLocalFileSystem,
			ikayzo : initAwsFileSystem,
			civilbeat : initCivilBeatFileSystem,
		};

		var fs = jQuery('#fileSystem').find('option:selected').val();
		fsLookup[fs](initializer);

		initializer.resultCallback = function(results) { console.log(results); window.close(); };
		console.log(initializer);
		var returnVal = window.showModalDialog('indri.html', initializer);
	}


	function initStandardExtensions(initializer) {
		initializer.filter.options.push({ value: "\.(htm|html)$", text: "HTML files (*.htm, *.html)"});
		initializer.filter.options.push({ value: "\.js$", text: "Javascript files (*.js)"});
		initializer.filter.options.push({ value: "\.(jpg|png)", text: "Image files (*.jpg, *.png)"});
	}

	function initLocalFileSystem(initializer) {
		initializer.locationRenderer = new SegmentedLocationRenderer();
	}

	function initAwsFileSystem(initializer) {
		initializer.visibility.shortcutsPanel = true;

		initializer.locationRenderer = new BucketLocationRenderer();

		initializer.previewRenderer.baseUrl = 'http://ikayzo-files.s3.amazonaws.com/';
	}

	function initCivilBeatFileSystem(initializer) {
		initializer.visibility.shortcutsPanel = true;

		initializer.locationRenderer = new BucketLocationRenderer();

		initializer.previewRenderer.baseUrl = 'http://civilbeat_production.s3.amazonaws.com/';
	}


	jQuery(document).ready(function() {
		jQuery("#openBtn").click(function() { showDialog(FileBrowser.prototype.OpenDialogInitializer); });
		jQuery("#saveBtn").click(function() { showDialog(FileBrowser.prototype.SaveDialogInitializer); });
		jQuery("#debugBtn").click(function() { showDialog(FileBrowser.prototype.DebugDialogInitializer); });
	});
</script>

</body>
</html>