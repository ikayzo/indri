/*! indri-0.5.0 2013-10-11 */
function FileSystemManager(rootUrl){this.rootUrl=rootUrl}function ContentRenderer(){}function ListContentRenderer(){this.name="List",this.text=IndriIcons.ICON_LIST_VIEW}function IconContentRenderer(){this.name="Icon",this.text=IndriIcons.ICON_ICON_VIEW}function DetailContentRenderer(){this.name="Detail",this.text=IndriIcons.ICON_DETAIL_VIEW}function splitPath(path,delimiter){var parts=[];return path.split(delimiter).forEach(function(item){item.length&&parts.push(item)}),parts}function StringLocationRenderer(){}function SegmentedLocationRenderer(){}function BucketLocationRenderer(){}function FileBrowser($rootElem,fileSystemManager,initializer){$rootElem.prop||($rootElem=jQuery($rootElem)),this.rootElem="indriui"==$rootElem.prop("id")?$rootElem:$rootElem.find("#indriui").first(),this.fsm=fileSystemManager,this._initialize(initializer)}if(FileSystemManager.prototype={getShortcuts:function(success,error){var url=this.rootUrl+"?action=shortcuts&";this._doQuery(url,success,error)},getRootLocation:function(success,error){var url=this.rootUrl+"?action=navigate&direction=home&";jQuery.getJSON(url,function(data){success(data.loc)}).fail(function(jqXHR,textStatus){console.log("FSM Error:",textStatus),error("FSM Error: "+textStatus)})},getRelativeLocation:function(location,direction,callback){var url=this.rootUrl+"?action=navigate&direction="+direction+"&loc="+this._encodeLocation(location);jQuery.getJSON(url,function(data){callback(data.loc)})},getContents:function(location,success,error){var url=this.rootUrl+"?action=browse";""!=location&&"."!=location&&(url+="&loc="+this._encodeLocation(location)),this._doQuery(url,success,error)},deleteItems:function(items,success,error){var locations=[];items.forEach(function(item){locations.push(item.location)});var url=this.rootUrl+"?action=delete&locs="+encodeURIComponent(JSON.stringify(locations));this._doQuery(url,success,error)},renameItem:function(item,newName,success,error){var url=this.rootUrl+"?action=rename&loc="+this._encodeLocation(item.location)+"&newName="+newName;this._doQuery(url,success,error)},createFolder:function(location,name,success,error){var url=this.rootUrl+"?action=makedir&loc="+this._encodeLocation(location)+"&name="+name;this._doQuery(url,success,error)},_doQuery:function(url,success,error){jQuery.ajaxSetup({cache:!1}),jQuery.getJSON(url,function(data,textStatus){data.error?error(data.error):success(data.contents,textStatus)}).fail(function(jqXHR,textStatus){console.log("FSM Error:",textStatus),error&&error("FSM Error: "+textStatus)})},_doQuery2:function(url){jQuery.ajax({url:url,dataType:"json"}).done(function(jqXHR,textStatus){console.log(textStatus)}).fail(function(jqXHR,textStatus){console.log(textStatus)}).always(function(jqXHR,textStatus){console.log(textStatus)})},_encodeLocation:function(location){return encodeURIComponent(location)}},"undefined"==typeof KeyEvent)var KeyEvent={KEYCODE_ENTER:13,KEYCODE_ESC:27,KEYCODE_DELETE:46};var MouseButtons={BUTTON_LEFT:1},IndriIcons={ICON_FOLDER:"&#128193;",ICON_DOCUMENT:"&#59190;",ICON_LIST_VIEW:"&#9776;",ICON_ICON_VIEW:"&#9871;",ICON_DETAIL_VIEW:"&#57349;",ICON_SORT_ASC:"&#59235;",ICON_SORT_DESC:"&#59232;"},IndriText={NEW_FOLDER_TEXT:"New Folder",MULTI_SELECT_ERR:"Error: Multiple selection is not allowed."};ContentRenderer.prototype={render:function(contents){return this._beginRender(),$list=this._renderContainer(),contents.forEach(function(contentItem){$list.append(this._renderItem(contentItem))},this),$list},updateSelection:function(newSelection){for(id in this.lookup)this.lookup[id].removeClass("ind-content-selected");newSelection.forEach(function(selectedItem){this.lookup[selectedItem.clientId].addClass("ind-content-selected")},this)},editItem:function(contentItem){var $listItem=this.lookup[contentItem.clientId];$listItem&&this._setupEditingEvents($listItem,contentItem)},keyHandler:function(evt){evt.which==(KeyEvent.KEYCODE_ENTER||KeyEvent.DOM_VK_RETURN)?evt.data._handleKeyEvent("enter"):evt.which==(KeyEvent.KEYCODE_DELETE||KeyEvent.DOM_VK_DELETE)&&evt.data._handleKeyEvent("delete")},_beginRender:function(){this.lookup={}},_initItem:function($listItem,contentItem){this.lookup[contentItem.clientId]=$listItem,this._setupNormalEvents($listItem,contentItem)},_setupEditingEvents:function($listItem,contentItem){var oldText,newText,$editable=$listItem.find(".ind-editable-name");oldText=$editable.html().replace(/"/g,"'");var endEditing=function(renderer){$input.replaceWith($editable),renderer._setupNormalEvents($listItem,contentItem)};$input=jQuery(document.createElement("input")).addClass("ind-editbox").attr("type","text").attr("value",oldText).keydown(this,function(evt){evt.which==(KeyEvent.KEYCODE_ENTER||KeyEvent.DOM_VK_RETURN)?(newText=$(this).val().replace(/"/g,"'"),$input.replaceWith($editable),evt.data._setupNormalEvents($listItem,contentItem),evt.data.callback(contentItem,"rename",newText)):evt.which==(KeyEvent.KEYCODE_ESC||KeyEvent.DOM_VK_ESCAPE)&&endEditing(evt.data)}).blur(this,function(evt){endEditing(evt.data)}).click(!1).dblclick(!1),$editable.replaceWith($input),$input.focus()},_setupNormalEvents:function($listItem,contentItem){$listItem.off("click").on("click",this,function(evt){evt.which==MouseButtons.BUTTON_LEFT&&evt.data.callback(contentItem,evt)}),$listItem.off("dblclick").on("dblclick",this,function(evt){evt.which==MouseButtons.BUTTON_LEFT&&evt.data.callback(contentItem,evt)})},_getIcon:function(contentItem){return $icon=jQuery(document.createElement("span")).addClass("entypo"),contentItem.isDir?$icon.addClass("ind-icon-folder").html(IndriIcons.ICON_FOLDER):$icon.addClass("ind-icon-file").html(IndriIcons.ICON_DOCUMENT),$icon}},ListContentRenderer.prototype=jQuery.extend({},new ContentRenderer,{_renderContainer:function(){return jQuery(document.createElement("ul")).addClass("ind-content ind-filelist").click(this,function(evt){evt.toElement==this&&evt.data.callback(null,"clear")})},_renderItem:function(contentItem){var $icon=this._getIcon(contentItem),$label=jQuery(document.createElement("span")).addClass("ind-editable-name").html(contentItem.name),$listItem=jQuery(document.createElement("li")).addClass("ind-listitem").append($icon).append($label);return this._initItem($listItem,contentItem),$listItem}}),IconContentRenderer.prototype=jQuery.extend({},new ContentRenderer,{showIconPreview:!1,_renderContainer:function(){return jQuery(document.createElement("ul")).addClass("ind-content ind-iconlist").click(this,function(evt){evt.toElement==this&&evt.data.callback(null,"clear")})},_renderItem:function(contentItem){var $icon=this._getIcon(contentItem),$label=jQuery(document.createElement("span")).addClass("ind-editable-name").html(contentItem.name),$listItem=jQuery(document.createElement("li")).addClass("ind-iconitem").append($icon).append("<br>").append($label);return this._initItem($listItem,contentItem),$listItem}}),DetailContentRenderer.prototype=jQuery.extend({},new ContentRenderer,{_renderContainer:function(){var renderer=this,$tr=jQuery(document.createElement("tr"));return this._fieldNames.forEach(function(field,index){var $th=jQuery(document.createElement("th")).html(renderer._columnTitles[index]);""!=field&&$th.click(this,function(evt){evt.target==this&&evt.which==MouseButtons.BUTTON_LEFT&&evt.data.browser.sorter.setSortField(field)}),field==this.browser.sorter.fieldName&&($th.addClass(this.browser.sorter.ascending?"ind-col-sort-asc":"ind-col-sort-desc"),$sortIndicator=jQuery(document.createElement("span")).addClass("ind-col-sort"),this.browser.sorter.ascending?$sortIndicator.addClass("ind-col-sort entypo").html(IndriIcons.ICON_SORT_ASC):$sortIndicator.addClass("ind-col-sort entypo").html(IndriIcons.ICON_SORT_DESC),$th.append($sortIndicator)),$tr.append($th)},this),jQuery(document.createElement("table")).addClass("ind-content ind-detaillist").append(jQuery(document.createElement("thead")).append($tr))},_renderItem:function(contentItem){var $tr=jQuery(document.createElement("tr"));$tr.append(jQuery(document.createElement("td")).append(this._getIcon(contentItem)));var $label=jQuery(document.createElement("span")).addClass("ind-editable-name").html(contentItem.name);return contentItem.isDir&&$label.addClass("ind-detailitem-dirname"),$tr.append(jQuery(document.createElement("td")).append($label)),$tr.append(jQuery(document.createElement("td")).html(this._formatSize(contentItem.size))),$tr.append(jQuery(document.createElement("td")).html(this._formatDate(contentItem.created))),$tr.append(jQuery(document.createElement("td")).html(this._formatDate(contentItem.modified))),this._initItem($tr,contentItem),$tr},_formatName:function(contentFile){return contentFile.name},_formatSize:function(size){return size?1024>size?size+" "+(1==size?"byte":"bytes"):1048576>size?(size/1024).toFixed(1)+" KB":(size/1048576).toFixed(1)+" MB":"--"},_formatDate:function(timestamp){return timestamp?new Date(timestamp).toDateString():"--"},_fieldNames:["isDir","name","size","created","modified"],_columnTitles:["","name","size","creation date","last modified date"],dateFormatString:"yyyy-MM-dd, hh:mm "}),StringLocationRenderer.prototype=jQuery.extend({},{render:function(elem,location){location&&(location=JSON.parse(location)),elem.html(location.toString())}}),SegmentedLocationRenderer.prototype=jQuery.extend({},{render:function($elem,location,callback){location=location?JSON.parse(location):"/";var parts=splitPath(location,"/");$elem.empty();var isEmptyPath=0==parts.length,$rootAnchor=jQuery(document.createElement(isEmptyPath?"span":"a")).html("(root)").addClass("ind-location-segment");isEmptyPath||$rootAnchor.click(JSON.stringify("/"),function(evt){callback(evt.data)}),$elem.append($rootAnchor);var fullPath="";parts.forEach(function(segment,index){$elem.append('<span class="ind-location-divider">&#62;</span>'),fullPath+="/"+segment;var isLastSegment=index==parts.length-1,$anchor=jQuery(document.createElement(isLastSegment?"span":"a")).html(segment).addClass("ind-location-segment");isLastSegment||$anchor.click(JSON.stringify(fullPath),function(evt){callback(evt.data)}),$elem.append($anchor)})}}),BucketLocationRenderer.prototype=jQuery.extend({},{render:function($elem,location,callback){if(location){var bucketData=JSON.parse(location),parts=splitPath(bucketData.key,"/"),targetLocation={bucket:bucketData.bucket,key:""};$elem.empty();var isEmptyPath=0==parts.length,$rootAnchor=jQuery(document.createElement(isEmptyPath?"span":"a")).html(bucketData.bucket).addClass("ind-location-segment");isEmptyPath||$rootAnchor.click(JSON.stringify(targetLocation),function(evt){callback(evt.data)}),$elem.append($rootAnchor),$elem.append(" : "),parts.forEach(function(segment,index){targetLocation.key+=segment+"/";var isLastSegment=index==parts.length-1,$anchor=jQuery(document.createElement(isLastSegment?"span":"a")).html(segment).addClass("ind-location-segment");isLastSegment||$anchor.click(JSON.stringify(targetLocation),function(evt){callback(evt.data)}),$elem.append($anchor),$elem.append(" / ")})}}}),FileBrowser.attach=function($rootElem,fileSystemManager,initializer){return new FileBrowser($rootElem,fileSystemManager,initializer)},FileBrowser.prototype={currentLocation:{},currentContents:{},allowItemSelection:!0,allowMultipleSelection:!1,allowDirsInResults:!1,currentSelection:[],filter:null,sorter:null,locationRenderer:null,contentRenderer:null,statusRenderer:null,previewRenderer:null,shortcutsRenderer:null,resultCallback:null,nextClientId:0,navigateToRoot:function(){this.fsm.getRootLocation(this._makeCallback(this.navigateToLocation),this._makeCallback(this._updateStatus))},navigateToLocation:function(location){var success=this._makeCallback(function(contents,status){this._updateLocation(location),this._updateContents(contents,status)});this.fsm.getContents(location,success,this._makeCallback(this._updateStatus))},navigateRelative:function(direction){this.fsm.getRelativeLocation(this.currentLocation,direction,this._makeCallback(this.navigateToLocation))},clearSelection:function(){this.currentSelection.length=0,this._selectionChanged()},createFolder:function(){var success=this._makeCallback(function(newContents,status){this._modifyContents(newContents,!1,status),this._beginEditingContentItem(newContents[0])});this.fsm.createFolder(this.currentLocation,IndriText.NEW_FOLDER_TEXT,success,this._makeCallback(this._updateStatus))},renameItem:function(contentItem,newName){var success=this._makeCallback(function(renamedContent,status){this._modifyContents([contentItem],!0,status),this._modifyContents(renamedContent,!1,status)});this.fsm.renameItem(contentItem,newName,success,this._makeCallback(this._updateStatus))},deleteSelected:function(){var targets=this.currentSelection,success=this._makeCallback(function(deletedContents,status){this._modifyContents(targets,!0,status)});this.fsm.deleteItems(this.currentSelection,success,this._makeCallback(this._updateStatus))},_updateLocation:function(location){this.currentLocation=location,this.locationRenderer?this.locationRenderer.render(this._getUiElem(this.uiNames.location),this.currentLocation,this._makeCallback(this.navigateToLocation)):this._getUiElem(this.uiNames.location).html(this.currentLocation)},_modifyContents:function(items,isDelete,status){items.forEach(function(item){isDelete?delete this.currentContents[item.clientId]:("undefined"==typeof item.clientId&&(item.clientId=this.nextClientId++),this.currentContents[item.clientId]=item)},this),this.currentSelection.length=0,isDelete||this.currentSelection.push(items[0]),this._populateContentUI(),this._updateStatus(status)},_updateContents:function(contents,status){this.currentContents={},this.nextClientId=0,contents.forEach(function(contentItem){contentItem.clientId=this.nextClientId++,this.currentContents[contentItem.clientId]=contentItem},this),this.currentSelection.length=0,this._populateContentUI(),this._updateStatus(status)},_populateContentUI:function(){var contents=[];for(contentId in this.currentContents)contents.push(this.currentContents[contentId]);var contents=this._applySorter(this._applyFilter(contents));this._getUiElem(this.uiNames.contentsPanel).empty().append(this.contentRenderer.render(contents,this._makeCallback(this._handleContentEvent))),this._selectionChanged()},_handleContentEvent:function(contentItem,evt,newName){"clear"==evt?this.clearSelection():"rename"==evt?this.renameItem(contentItem,newName):"dblclick"==evt.type?contentItem.isDir?this.navigateToLocation(contentItem.location):(this._applySelectionToItem(contentItem,evt.metaKey),this._returnResults(!0)):"click"==evt.type&&this._applySelectionToItem(contentItem,evt.metaKey)},_handleKeyEvent:function(evt){if("delete"==evt)this.deleteSelected();else if("enter"==evt){var contentItem=this.currentSelection[0];contentItem&&(contentItem.isDir?this.navigateToLocation(contentItem.location):(this._applySelectionToItem(contentItem,evt.metaKey),this._returnResults(!0)))}},_beginEditingContentItem:function(contentItem){!contentItem&&this.currentSelection.length&&(contentItem=this.currentSelection[0]),contentItem&&this.contentRenderer.editItem(contentItem)},_updateShortcuts:function(callback){callback||(callback=this._makeCallback(this._populateShortcuts)),this.shortcuts=[],this.fsm.getShortcuts(callback,this._makeCallback(this._updateStatus))},_populateShortcuts:function(shortcuts){this.shortcutsRenderer&&this._getUiElem(this.uiNames.shortcutsPanel).empty().append(this.shortcutsRenderer.render(shortcuts,this._makeCallback(this.navigateToLocation)))},_updateStatus:function(status){this.statusRenderer?this.statusRenderer.render(this._getUiElem(this.uiNames.status),status):this._getUiElem(this.uiNames.status).html(status)},_setRenderer:function(renderer){this.contentRenderer=renderer,renderer.browser=this,renderer.callback=this._makeCallback(this._handleContentEvent),renderer.lookup={},this._populateContentUI()},_applySelectionToItem:function(contentItem,metaKey){var includeInSelection=this.allowItemSelection||contentItem.isDir,index=jQuery.inArray(contentItem,this.currentSelection);metaKey&&this.allowMultipleSelection?-1==index?includeInSelection&&this.currentSelection.push(contentItem):this.currentSelection.splice(index,1):(this.currentSelection.length=0,includeInSelection&&this.currentSelection.push(contentItem)),this._selectionChanged(includeInSelection?null:contentItem)},_selectionChanged:function(unincludedItem){this.contentRenderer.updateSelection(this.currentSelection);var filenameText="",prefix="";this.currentSelection.forEach(function(selectedItem){filenameText+=prefix+selectedItem.name,prefix=";"}),unincludedItem&&(filenameText+=prefix+unincludedItem.name),this._getUiElem(this.uiNames.filename).val(filenameText),this._setEnabled(this.uiNames.delete,0!=this.currentSelection.length),this._setEnabled(this.uiNames.rename,1==this.currentSelection.length),this._setEnabled(this.uiNames.accept,0!=this._getResults().length||unincludedItem),this.previewRenderer&&this._getUiElem(this.uiNames.previewWrapper).empty().append(this.previewRenderer.render(this.currentSelection))},_filterChanged:function(){this.currentSelection.length=0,this._populateContentUI()},_applyFilter:function(items){return this.filter?this.filter.apply(items):items},_sortChanged:function(){this._populateContentUI()},_applySorter:function(items){return this.sorter?this.sorter.apply(items):items},_makeCallback:function(callback){var fileBrowser=this;return function(){return callback.apply(fileBrowser,arguments)}},_getResults:function(){var results=[];return this.currentSelection.forEach(function(selectedItem){(this.allowDirsInResults||!selectedItem.isDir)&&results.push(selectedItem)},this),results},_returnResults:function(returnValue){this.resultCallback({success:returnValue,location:this.currentLocation,selection:this._getResults(),filename:this._getUiElem(this.uiNames.filename).val()})},_initialize:function(initializer){var indriMain=this;initializer||(initializer=new this.DefaultInitializer);for(textItem in initializer.texts)this._getUiElem(this.uiNames[textItem]).html(initializer.texts[textItem]);for(visibility in initializer.visibility)this._setVisible(this.uiNames[visibility],initializer.visibility[visibility]);this.currentLocation={},this.currentContents={},this.currentSelection=[],this.allowItemSelection=initializer.allowItemSelection,this.allowMultipleSelection=initializer.allowMultipleSelection,this.allowDirsInResults=initializer.allowDirsInResults,this.sorter=initializer.sorter,this.sorter.browser=this,this.locationRenderer=initializer.locationRenderer,this.statusRenderer=initializer.statusRenderer,this.previewRenderer=initializer.previewRenderer,this.shortcutsRenderer=initializer.shortcutsRenderer,this.resultCallback=initializer.resultCallback,this._initializeFiltering(initializer.filter),this._initializeViews(initializer.viewFactory);var fileBrowser=this;this._getUiElem(this.uiNames.parent).click(function(){fileBrowser.navigateRelative("parent")}),this._getUiElem(this.uiNames.refresh).click(function(){fileBrowser.navigateToLocation(fileBrowser.currentLocation)}),this._getUiElem(this.uiNames.contentsPanel).click(function(evt){evt.toElement==this&&fileBrowser.clearSelection()}),this._getUiElem(this.uiNames.filename).keyup(function(){console.log(jQuery(this).val()),fileBrowser._setEnabled(fileBrowser.uiNames.accept,0!=fileBrowser._getResults().length||""!=jQuery(this).val())}),this._getUiElem(this.uiNames.filename).blur(function(){jQuery(indriMain._getUiElem(indriMain.uiNames.focusTextbox)).focus()}),this._getUiElem(this.uiNames.preview).click(function(){fileBrowser._toggleVisible(fileBrowser.uiNames.previewWrapper)}),this._getUiElem(this.uiNames.shortcuts).click(function(){fileBrowser._toggleVisible(fileBrowser.uiNames.shortcutsPanel)}),this._getUiElem(this.uiNames.delete).click(function(){fileBrowser.deleteSelected()}),this._getUiElem(this.uiNames.newFolder).click(function(){fileBrowser.createFolder()}),this._getUiElem(this.uiNames.rename).click(function(){fileBrowser._beginEditingContentItem()}),this._getUiElem(this.uiNames.accept).click(function(){fileBrowser._returnResults(!0)}),this._getUiElem(this.uiNames.cancel).click(function(){fileBrowser._returnResults(!1)}),initializer.visibility.shortcutsPanel?this._updateShortcuts(this._makeCallback(function(shortcuts){this._populateShortcuts(shortcuts),shortcuts.length>0?this.navigateToLocation(shortcuts[0].location):this.navigateToRoot()})):this.navigateToRoot(),jQuery(jQuery("#indriui").parent()).on("keydown",this,initializer.viewFactory.views[0].keyHandler),jQuery(this.uiNames.focusTextbox).focus(),jQuery(indriMain.uiNames.contentsPanel+", "+indriMain.uiNames.headerWrapper).click(function(){jQuery(indriMain.uiNames.focusTextbox).focus()})},_initializeFiltering:function(filter){this.filter=filter,this._getUiElem(this.uiNames.filter).empty().append(this.filter.render(this._makeCallback(this._filterChanged)))},_initializeViews:function(viewFactory){viewFactory.render(this._makeCallback(function(view){this._setRenderer(view)}),this._getUiElem(this.uiNames.viewsPanel))},uiNames:{title:"#title-control",shortcuts:"#shortcuts-control",parent:"#parent-control",refresh:"#refresh-control",location:"#location-control",viewsPanel:"#views-panel",preview:"#preview-control",shortcutsPanel:"#shortcuts-wrapper",headerWrapper:"#header-wrapper",contentsWrapper:"#contents-wrapper",contentsPanel:"#contents-panel",previewWrapper:"#preview-wrapper",newFolder:"#newfolder-control","delete":"#delete-control",rename:"#rename-control",status:"#status-control",filter:"#filters-panel",filename:"#filename-control",filenameLabel:"#filename-label-control",accept:"#accept-control",cancel:"#cancel-control",focusTextbox:"#ind-focus-textbox"},_getUiElem:function(name){return this.rootElem.find(name)},_setVisible:function(name,isVisible){var displayMode=isVisible?"":"none";if(this._getUiElem(name).css("display",displayMode),name==this.uiNames.previewWrapper||name==this.uiNames.shortcutsPanel){var controlName=name==this.uiNames.previewWrapper?this.uiNames.preview:this.uiNames.shortcuts,className=name==this.uiNames.previewWrapper?"ind-show-preview":"ind-show-shortcuts";isVisible?(this._getUiElem(this.uiNames.contentsWrapper).addClass(className),this._getUiElem(controlName).addClass("ind-btn-active")):(this._getUiElem(this.uiNames.contentsWrapper).removeClass(className),this._getUiElem(controlName).removeClass("ind-btn-active "))}name==this.uiNames.shortcutsPanel&&this._updateShortcuts(),name==this.uiNames.filename&&this._getUiElem(this.uiNames.filenameLabel).css("display",displayMode)},_toggleVisible:function(name){this._setVisible(name,"none"==this._getUiElem(name).css("display"))},_setEnabled:function(name,isEnabled){var $uiElem=this._getUiElem(name);isEnabled?($uiElem.removeAttr("disabled"),$uiElem.removeClass("ind-btn-dis")):($uiElem.attr("disabled","true"),$uiElem.addClass("ind-btn-dis"))}},FileBrowser.prototype.DefaultInitializer={texts:{title:"FileChooser",accept:"OK",cancel:"Cancel"},visibility:{previewWrapper:!1,shortcutsPanel:!1,newFolder:!1,"delete":!1,rename:!1,filename:!1,filter:!1},directoriesOnly:!1,allowMultipleSelection:!1,sorter:{fieldName:"name",ascending:!0,apply:function(items){if(this.fieldName){var fieldName=this.fieldName,inverter=this.ascending?1:-1;return items.sort(function(a,b){var aValue=a[fieldName],bValue=b[fieldName];return aValue==bValue?0:aValue?bValue?(aValue.toLowerCase&&bValue.toLowerCase&&(aValue=aValue.toLowerCase(),bValue=bValue.toLowerCase()),bValue>aValue?-1*inverter:1*inverter):1*inverter:-1*inverter})}return items},setSortField:function(fieldName){this.fieldName==fieldName?this.ascending=!this.ascending:(this.fieldName=fieldName,this.ascending=!0),this.browser._sortChanged()}},filter:{options:[{value:".*",text:"All files (*.*)"}],_selectedFilter:null,apply:function(items){var filter=this._selectedFilter,filteredItems=items.filter(function(item){return item.isDir||item.name.match(filter)},this.options);return filteredItems},render:function(callback){var $select=jQuery(document.createElement("select")).attr("id","filterSelector").change(this,function(evt){evt.data._selectedFilter=new RegExp(jQuery(this).find("option:selected").val()),callback()});return this.options.forEach(function(option){var item=jQuery(document.createElement("option")).attr("value",option.value).html(option.text);$select.append(item)}),this._selectedFilter=new RegExp(this.options[0].value),$select}},viewFactory:{views:[new ListContentRenderer],render:function(callback,container){container?container.empty():container=jQuery(document.createElement("div"));var btnId=0;return this.views.forEach(function(view){var $anchor=jQuery(document.createElement("a")).addClass("ind-viewbutton entypo ind-btn").attr("id","ind-viewbutton-"+btnId);$anchor.click($anchor,function(evt){jQuery(".ind-viewbutton").removeClass("ind-btn-active"),jQuery(evt.data).addClass("ind-btn-active"),callback(view)}),0==btnId&&$anchor.addClass("ind-btn-active"),view.img?$anchor.append(jQuery(document.createElement("img")).attr("src",view.img)):view.text?$anchor.append(jQuery(document.createElement("span")).html(view.text)):$anchor.append(jQuery(document.createElement("span")).html(view.name)),container.append($anchor),btnId++}),callback(this.views[0]),container}},locationRenderer:new StringLocationRenderer,statusRenderer:{render:function(elem,status){elem.html("<strong>"+status+"</strong>")}},previewRenderer:{render:function(selection){return 0==selection.length?jQuery(document.createElement("span")).html("No items selected"):selection.length>1?jQuery(document.createElement("span")).html("Multiple items selected"):null==selection[0].previewUrl?jQuery(document.createElement("span")).html("No preview available"):jQuery(document.createElement("img")).attr("src",selection[0].previewUrl)}},shortcutsRenderer:{render:function(shortcuts,callback){var $listContainer=jQuery(document.createElement("ul")).addClass("ind-shortcut-list");return shortcuts.forEach(function(shortcut){var $label=jQuery(document.createElement("span")).addClass("ind-shortcut-name").html(shortcut.name),$listItem=jQuery(document.createElement("li")).addClass("ind-listitem ind-shortcut-item").append($label);$listItem.click($listItem,function(evt){1==evt.which&&(jQuery(".ind-shortcut-item").removeClass("ind-shortcut-selected"),jQuery(evt.data).addClass("ind-shortcut-selected"),callback(shortcut.location))}),$listContainer.append($listItem)}),$listContainer}},resultCallback:function(results){console.log(results)}},FileBrowser.prototype.DebugDialogInitializer=jQuery.extend(!0,{},FileBrowser.prototype.DefaultInitializer,{allowItemSelection:!0,allowMultipleSelection:!0,allowDirsInResults:!1,texts:{title:"Test Dialog"},visibility:{previewWrapper:!0,shortcutsPanel:!0,newFolder:!0,"delete":!0,rename:!0,filename:!0,filter:!0}}),FileBrowser.prototype.SaveDialogInitializer=jQuery.extend(!0,{},FileBrowser.prototype.DefaultInitializer,{allowItemSelection:!1,allowMultipleSelection:!1,allowDirsInResults:!1,texts:{title:"Save File",accept:"Save",cancel:"Cancel"},visibility:{previewWrapper:!1,shortcutsPanel:!1,newFolder:!0,"delete":!0,rename:!0,filename:!0}}),FileBrowser.prototype.OpenDialogInitializer=jQuery.extend(!0,{},FileBrowser.prototype.DefaultInitializer,{allowItemSelection:!0,allowMultipleSelection:!0,allowDirsInResults:!1,texts:{title:"Open File(s)",accept:"Open",cancel:"Cancel"},visibility:{previewWrapper:!0,shortcutsPanel:!1,filter:!0}}),FileBrowser.prototype.DestinationDialogInitializer=jQuery.extend(!0,{},FileBrowser.prototype.DefaultInitializer,{allowItemSelection:!1,allowMultipleSelection:!1,allowDirsInResults:!0,texts:{title:"Select Target Folder",accept:"Select",cancel:"Cancel"},visibility:{previewWrapper:!1,shortcutsPanel:!0,filter:!1,"delete":!0,rename:!0,filename:!1,newFolder:!0},filter:{apply:function(items){var filteredItems=items.filter(function(item){return item.isDir});return filteredItems},render:function(){}}});